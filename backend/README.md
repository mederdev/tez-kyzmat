# –¢–µ–∑ –ö—ã–∑–º–∞—Ç - Backend API

–ë—ç–∫–µ–Ω–¥ API –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–æ–∏—Å–∫–∞ —Å–µ–ª—å—Å–∫–æ—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–π –∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏ –≤ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–µ.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **NestJS** - Node.js —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Fastify** - HTTP —Å–µ—Ä–≤–µ—Ä (–±—ã—Å—Ç—Ä–µ–µ Express)
- **TypeORM** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **MySQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **JWT** - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Swagger** - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **TypeScript** - –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JavaScript

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone <repository-url>
cd backend
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

   - –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö MySQL —Å –∏–º–µ–Ω–µ–º `tez_kyzmat`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–¥—É—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã –≤ dev —Ä–µ–∂–∏–º–µ):

```bash
npm run start:dev
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_HOST=localhost
DB_PORT=3306
DB_NAME=tez_kyzmat
DB_USERNAME=root
DB_PASSWORD=your_password

# JWT
JWT_SECRET=your_super_secret_jwt_key
JWT_EXPIRES_IN=30d

# SMS API (Nikita.kg)
SMS_LOGIN=your_nikita_login
SMS_PASSWORD=your_nikita_password
SMS_SENDER=TezKyzmat
SMS_API_URL=https://smspro.nikita.kg/api/message

# –§–∞–π–ª—ã
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880

# –°–µ—Ä–≤–µ—Ä
PORT=3001
NODE_ENV=development

# CORS
CORS_ORIGIN=http://localhost:3000

# Rate Limiting
THROTTLE_TTL=60000
THROTTLE_LIMIT=100
```

## üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
npm run start:dev
```

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

```bash
npm run start:debug
```

### –ü—Ä–æ–¥–∞–∫—à–Ω

```bash
npm run build
npm run start
```

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

- **Swagger UI**: http://localhost:3001/docs
- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: http://localhost:3001/api

## üì± SMS –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Nikita.kg)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SMS API

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Nikita.kg:**

   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://nikita.kg/
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –ø–∞—Ä—Ç–Ω–µ—Ä
   - –ü–æ–ª—É—á–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è SMS API

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

   ```env
   SMS_LOGIN=your_nikita_login
   SMS_PASSWORD=your_nikita_password
   SMS_SENDER=TezKyzmat
   ```

3. **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ API:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç XML —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ 50 –Ω–æ–º–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ SMS: 800 —Å–∏–º–≤–æ–ª–æ–≤
   - –ö–∏—Ä–∏–ª–ª–∏—Ü–∞: 70 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ SMS
   - –õ–∞—Ç–∏–Ω–∏—Ü–∞: 160 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ SMS

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SMS

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (`NODE_ENV=development`) SMS –∫–æ–¥—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

```bash
[SmsService] üì± SMS –∫–æ–¥ –¥–ª—è +996700123456: 123456
```

–í –ø—Ä–æ–¥–∞–∫—à–Ω–µ SMS –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ API Nikita.kg.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

- **Beeline** (996700, 996770, 996220)
- **Megacom** (996550, 996555, 996559)
- **O!** (996500, 996501, 996502, 996503, 996504, 996505, 996506, 996507, 996508, 996509)
- **Nurtel** (996540)

## üîó API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- `POST /api/auth/send-code` - –û—Ç–ø—Ä–∞–≤–∫–∞ SMS –∫–æ–¥–∞
- `POST /api/auth/verify-login` - –í—Ö–æ–¥ –ø–æ SMS –∫–æ–¥—É
- `POST /api/auth/verify-register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ SMS –∫–æ–¥—É

### –û–±—ä—è–≤–ª–µ–Ω–∏—è

- `GET /api/services` - –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π)
- `POST /api/services` - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `GET /api/services/:id` - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ ID
- `PATCH /api/services/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- `DELETE /api/services/:id` - –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- `GET /api/services/my` - –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- `GET /api/services/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏

- `GET /api/common/categories` - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Ö–Ω–∏–∫–∏
- `GET /api/common/locations` - –†–µ–≥–∏–æ–Ω—ã –∏ —Ä–∞–π–æ–Ω—ã
- `GET /api/common/districts/:location` - –†–∞–π–æ–Ω—ã —Ä–µ–≥–∏–æ–Ω–∞

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:

1. **`users`** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
2. **`services`** - –û–±—ä—è–≤–ª–µ–Ω–∏—è –æ —Ç–µ—Ö–Ω–∏–∫–µ
3. **`verification_codes`** - SMS –∫–æ–¥—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MySQL:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
mysql -u root -p
CREATE DATABASE tez_kyzmat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
mysql -u root -p < database/init.sql
```

### Docker:

```bash
# –ó–∞–ø—É—Å–∫ MySQL –≤ Docker
docker-compose up -d mysql

# –î–æ—Å—Ç—É–ø –∫ phpMyAdmin
open http://localhost:8080
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–∏–º–≤–æ–ª—ã –≤–∏–¥–∞ `√ê≈ì√ê¬¢√ê‚Äî-80` –≤–º–µ—Å—Ç–æ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã:

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
mysql -u root -p < database/fix-encoding.sql
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [database/ENCODING_FIX.md](database/ENCODING_FIX.md)

### –ü—Ä–æ–±–ª–µ–º—ã —Å SMS

1. **SMS –∫–æ–¥—ã –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç:**

   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `SMS_LOGIN` –∏ `SMS_PASSWORD`
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –±–∞–ª–∞–Ω—Å –≤ Nikita.kg
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

2. **–û—à–∏–±–∫–∞ "SMS_LOGIN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω":**
   - –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env` —Ñ–∞–π–ª
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

## üöÄ –î–µ–ø–ª–æ–π

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

   ```env
   NODE_ENV=production
   DB_HOST=your_production_db_host
   JWT_SECRET=your_very_secure_key
   SMS_LOGIN=your_real_nikita_login
   SMS_PASSWORD=your_real_nikita_password
   ```

2. **–°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:**

   ```bash
   npm run build
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ:**
   ```bash
   npm run start
   ```

### Docker –¥–µ–ø–ª–æ–π:

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t tez-kyzmat-backend .

# –ó–∞–ø—É—Å–∫ —Å docker-compose
docker-compose up -d
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–∫–æ–≥–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
npm test

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
npx tsc --noEmit

# –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞
npx eslint src/
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

–í—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

- SMS –æ—Ç–ø—Ä–∞–≤–∫–∞
- –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–µ—Ç—Ä–∏–∫–∏

- Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API: 10 —Å–µ–∫—É–Ω–¥
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 5MB

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- Email: support@tez-kyzmat.kg
- Telegram: @tez_kyzmat_support
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:3001/docs
